{% extends 'base.html' %}

{% block title %}{{ student.vorname }} {{ student.nachname }} - Lernmanager{% endblock %}

{% block content %}
<div class="flex flex-between flex-center mb-2">
    <h1>ğŸ‘¤ {{ student.nachname }}, {{ student.vorname }}</h1>
    <div class="flex gap-1">
        <a href="{{ url_for('admin_student_activity', student_id=student.id) }}" class="btn btn-secondary">ğŸ“Š AktivitÃ¤t</a>
        <div class="btn-group">
            <a href="{{ url_for('admin_schueler_bericht', student_id=student.id, type='summary') }}" class="btn btn-success">ğŸ“„ Bericht (Zusammenfassung)</a>
            <a href="{{ url_for('admin_schueler_bericht', student_id=student.id, type='complete') }}" class="btn btn-success">ğŸ“‹ Bericht (VollstÃ¤ndig)</a>
        </div>
        <form method="POST" action="{{ url_for('admin_schueler_loeschen', student_id=student.id) }}" onsubmit="return confirm('SchÃ¼ler wirklich lÃ¶schen?');" style="display: inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ LÃ¶schen</button>
        </form>
    </div>
</div>

<div class="grid grid-2">
    <!-- Login Info -->
    <div class="card">
        <div class="card-header">ğŸ”‘ Anmeldedaten</div>
        <p><strong>Benutzername:</strong> <code>{{ student.username }}</code></p>
        <p class="text-muted" style="font-size: 0.9em;">Passwort nur bei Erstellung oder Reset sichtbar</p>
        <form method="POST" action="{{ url_for('admin_schueler_passwort_reset', student_id=student.id) }}"
              onsubmit="return confirm('Passwort wirklich zurÃ¼cksetzen? Das alte Passwort wird ungÃ¼ltig.');" class="mt-1">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-warning">ğŸ”„ Passwort zurÃ¼cksetzen</button>
        </form>
    </div>

    <!-- Classes -->
    <div class="card">
        <div class="card-header">ğŸ“ Klassen</div>
        {% if klassen %}
        <ul class="material-list">
            {% for klasse in klassen %}
            <li class="material-item">
                <a href="{{ url_for('admin_klasse_detail', klasse_id=klasse.id) }}">{{ klasse.name }}</a>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">Keine Klassen zugewiesen.</p>
        {% endif %}
    </div>
</div>

<!-- Move Student -->
{% if klassen %}
<div class="card mt-2">
    <div class="card-header">ğŸ”„ SchÃ¼ler verschieben</div>
    <form method="POST" action="{{ url_for('admin_schueler_verschieben', student_id=student.id) }}" class="flex gap-1 flex-center">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label>Von:</label>
        <select name="from_klasse" class="form-control" style="width: auto;" required>
            {% for klasse in klassen %}
            <option value="{{ klasse.id }}">{{ klasse.name }}</option>
            {% endfor %}
        </select>
        <label>Nach:</label>
        <select name="to_klasse" class="form-control" style="width: auto;" required>
            {% for klasse in all_klassen %}
            <option value="{{ klasse.id }}">{{ klasse.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">Verschieben</button>
    </form>
</div>
{% endif %}

<!-- Assign Individual Task -->
{% if klassen %}
<div class="card mt-2">
    <div class="card-header">ğŸ“ Individuelle Aufgabe zuweisen</div>
    <form method="POST" action="{{ url_for('admin_schueler_aufgabe_zuweisen', student_id=student.id) }}" class="flex gap-1 flex-center">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label>Klasse:</label>
        <select name="klasse_id" class="form-control" style="width: auto;" required>
            {% for klasse in klassen %}
            <option value="{{ klasse.id }}">{{ klasse.name }}</option>
            {% endfor %}
        </select>
        <label>Aufgabe:</label>
        <select name="task_id" class="form-control" style="flex: 1;" required>
            <option value="">-- Aufgabe wÃ¤hlen --</option>
            {% for task in tasks %}
            <option value="{{ task.id }}">{{ task.fach }} ({{ task.stufe }}): {{ task.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">Zuweisen</button>
    </form>
</div>

<!-- Manual Task Completion -->
<div class="card mt-2">
    <div class="card-header">âœ… Aufgabe manuell abschlieÃŸen</div>
    <div class="flex gap-1">
        {% for klasse in klassen %}
        <form method="POST" action="{{ url_for('admin_schueler_aufgabe_abschliessen', student_id=student.id, klasse_id=klasse.id) }}" style="display: inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-success">{{ klasse.name }} abschlieÃŸen</button>
        </form>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
