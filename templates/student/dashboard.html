{% extends 'base.html' %}

{% block title %}Meine Themen - Lernmanager{% endblock %}

{% block content %}
<div class="flex flex-between flex-center mb-2">
    <h1>Hallo, {{ student.vorname }}!</h1>
    <a href="{{ url_for('student_bericht') }}" class="btn btn-success">ğŸ“Š Mein Lernfortschritt</a>
</div>

{% if klassen %}
<div class="grid grid-2">
    {% for klasse in klassen %}
    {% set task = tasks_by_klasse.get(klasse.id) %}
    <div class="card task-card {% if task and task.abgeschlossen %}complete{% elif task and task.kategorie == 'bonus' %}bonus{% endif %}">
        <div class="card-header flex flex-between">
            <span>ğŸ“ {{ klasse.name }}</span>
            {% if task %}
                {% if task.abgeschlossen %}
                <span class="badge badge-success">âœ… Fertig</span>
                {% else %}
                <span class="badge badge-primary">ğŸ”„ In Arbeit</span>
                {% endif %}
            {% endif %}
        </div>

        {% if task %}
            <h3>{{ task.name }}</h3>
            {% if task.kategorie == 'bonus' %}
            <span class="badge badge-warning mb-1">â­ Bonusthema</span>
            {% endif %}

            <p class="text-muted mb-1">{{ task.fach }} Â· {{ task.stufe }}</p>

            {% if task.lernziel %}
            <div class="mb-1"><strong>ğŸ¯ Lernziel:</strong> <span class="markdown-content">{{ task.lernziel | markdown }}</span></div>
            {% endif %}

            <!-- Progress -->
            {% if task.total_subtasks > 0 %}
            <div class="mb-1">
                <div class="flex flex-between mb-1">
                    <span>Fortschritt</span>
                    <span>{{ task.completed_subtasks }}/{{ task.total_subtasks }}</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar {% if task.completed_subtasks == task.total_subtasks %}complete{% endif %}"
                         style="width: {{ (task.completed_subtasks / task.total_subtasks * 100) if task.total_subtasks > 0 else 0 }}%;"></div>
                </div>
            </div>
            {% endif %}

            <a href="{{ url_for('student_klasse', klasse_id=klasse.id) }}" class="btn btn-primary">
                {% if task.abgeschlossen %}Details ansehen{% else %}Weiter lernen â†’{% endif %}
            </a>
        {% else %}
            <p class="text-muted">Kein Thema zugewiesen.</p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card text-center text-muted">
    <p>Du bist noch keiner Klasse zugeordnet.</p>
</div>
{% endif %}
{% endblock %}
